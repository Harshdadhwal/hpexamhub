<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description"
        content="Free HP JBT 2025 Mock Test - Practice with actual exam pattern questions for Hindi, English, Numerical Ability, and General Awareness">
    <title>HP JBT 2025 Mock Test | HPExamHub.in</title>
    <link rel="icon" href="/assets/logo.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet" />
    <style>
        body {
            font-family: 'Nunito', sans-serif;
        }

        /* Fullscreen test mode styles */
        .test-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 1000;
            overflow-y: auto;
            display: none;
        }

        /* Enhanced animations */
        .fade-in {
            animation: fadeIn 0.4s ease-in-out;
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Timer animations */
        .timer-warning {
            animation: pulse 1.5s infinite;
            color: #f59e0b;
        }

        .timer-critical {
            animation: urgentPulse 1s infinite;
            color: #ef4444;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        @keyframes urgentPulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.8;
                transform: scale(1.05);
            }
        }

        /* Question option hover effects */
        .option-hover {
            transition: all 0.2s ease;
        }

        .option-hover:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Section progress indicator */
        .progress-bar {
            transition: width 0.3s ease;
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Enhanced button styles */
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800">

    <!-- Mock Test Landing Page -->
    <div id="landing-page" class="fade-in">
        <!-- Header -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16 items-center">
                    <div class="flex items-center">
                        <a href="/" class="flex items-center">
                            <img src="/assets/logo.png" alt="HP Exam Hub" class="h-8 w-auto"
                                onerror="this.style.display='none'">
                            <span class="ml-2 text-xl font-bold text-blue-800">HP Exam Hub</span>
                        </a>
                    </div>
                    <nav class="hidden md:flex space-x-8">
                        <a href="/" class="text-gray-700 hover:text-blue-600 px-3 py-2 font-medium transition">Home</a>
                        <a href="/papers"
                            class="text-gray-700 hover:text-blue-600 px-3 py-2 font-medium transition">Papers</a>
                        <a href="/notifications"
                            class="text-gray-700 hover:text-blue-600 px-3 py-2 font-medium transition">Notifications</a>
                    </nav>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <section class="py-12 bg-gradient-to-br from-blue-50 to-indigo-100">
            <div class="max-w-6xl mx-auto px-4">
                <div class="text-center mb-12">
                    <h1 class="text-4xl md:text-5xl font-bold text-blue-900 mb-6">HP JBT 2025 Mock Test</h1>
                    <p class="text-xl text-gray-700 max-w-3xl mx-auto leading-relaxed">
                        Experience the actual JBT exam pattern with this comprehensive mock test.
                        Boost your confidence and identify areas for improvement!
                    </p>
                </div>

                <!-- Test Details Card -->
                <div class="bg-white rounded-2xl shadow-xl p-8 mb-10 slide-in">
                    <h2 class="text-3xl font-bold text-blue-800 mb-6 text-center">Test Overview</h2>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="space-y-4">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
                                <svg class="w-6 h-6 text-blue-600 mr-2" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                Exam Pattern
                            </h3>
                            <div class="space-y-3">
                                <div class="flex items-center p-3 bg-green-50 rounded-lg">
                                    <div class="w-2 h-2 bg-green-500 rounded-full mr-3"></div>
                                    <span><strong>Total Questions:</strong> 100</span>
                                </div>
                                <div class="flex items-center p-3 bg-blue-50 rounded-lg">
                                    <div class="w-2 h-2 bg-blue-500 rounded-full mr-3"></div>
                                    <span><strong>Duration:</strong> 120 minutes</span>
                                </div>
                                <div class="flex items-center p-3 bg-purple-50 rounded-lg">
                                    <div class="w-2 h-2 bg-purple-500 rounded-full mr-3"></div>
                                    <span><strong>Marking:</strong> No Negative Marking</span>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
                                <svg class="w-6 h-6 text-green-600 mr-2" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                                </svg>
                                Sections
                            </h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center p-3 bg-orange-50 rounded-lg">
                                    <span class="font-medium">Hindi</span>
                                    <span class="bg-orange-200 px-2 py-1 rounded-full text-sm">25 Q</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                                    <span class="font-medium">English</span>
                                    <span class="bg-red-200 px-2 py-1 rounded-full text-sm">25 Q</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-indigo-50 rounded-lg">
                                    <span class="font-medium">Numerical Ability</span>
                                    <span class="bg-indigo-200 px-2 py-1 rounded-full text-sm">25 Q</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-cyan-50 rounded-lg">
                                    <span class="font-medium">General Awareness</span>
                                    <span class="bg-cyan-200 px-2 py-1 rounded-full text-sm">25 Q</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Start Test Button -->
                <div class="text-center">
                    <button id="start-test-btn"
                        class="btn-success text-white font-bold py-4 px-12 rounded-xl text-xl transition transform hover:scale-105 shadow-lg">
                        <svg class="w-6 h-6 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1.01M15 10h1.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Start Mock Test
                    </button>
                    <p class="text-sm text-gray-600 mt-4">
                        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                        No registration required • Fullscreen mode • Auto-save progress
                    </p>
                </div>
            </div>
        </section>

        <!-- Instructions Section -->
        <section class="py-16 bg-white">
            <div class="max-w-4xl mx-auto px-4">
                <h2 class="text-3xl font-bold text-center mb-12 text-blue-800">Important Instructions</h2>

                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl shadow-lg p-8">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">Before You Start</h3>
                            <ul class="space-y-3">
                                <li class="flex items-start">
                                    <svg class="w-5 h-5 text-green-500 mr-3 mt-0.5 flex-shrink-0" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M5 13l4 4L19 7" />
                                    </svg>
                                    <span class="text-gray-700">Ensure stable internet connection</span>
                                </li>
                                <li class="flex items-start">
                                    <svg class="w-5 h-5 text-green-500 mr-3 mt-0.5 flex-shrink-0" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M5 13l4 4L19 7" />
                                    </svg>
                                    <span class="text-gray-700">Use laptop/desktop for best experience</span>
                                </li>
                                <li class="flex items-start">
                                    <svg class="w-5 h-5 text-green-500 mr-3 mt-0.5 flex-shrink-0" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M5 13l4 4L19 7" />
                                    </svg>
                                    <span class="text-gray-700">Find a quiet environment</span>
                                </li>
                            </ul>
                        </div>
                        <div class="space-y-4">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">During the Test</h3>
                            <ul class="space-y-3">
                                <li class="flex items-start">
                                    <svg class="w-5 h-5 text-blue-500 mr-3 mt-0.5 flex-shrink-0" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M13 10V3L4 14h7v7l9-11h-7z" />
                                    </svg>
                                    <span class="text-gray-700">Navigate freely between sections</span>
                                </li>
                                <li class="flex items-start">
                                    <svg class="w-5 h-5 text-blue-500 mr-3 mt-0.5 flex-shrink-0" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M13 10V3L4 14h7v7l9-11h-7z" />
                                    </svg>
                                    <span class="text-gray-700">Monitor time with live timer</span>
                                </li>
                                <li class="flex items-start">
                                    <svg class="w-5 h-5 text-blue-500 mr-3 mt-0.5 flex-shrink-0" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M13 10V3L4 14h7v7l9-11h-7z" />
                                    </svg>
                                    <span class="text-gray-700">Review answers before submitting</span>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="mt-8 p-4 bg-yellow-100 rounded-lg border-l-4 border-yellow-500">
                        <div class="flex items-start">
                            <svg class="w-5 h-5 text-yellow-600 mr-3 mt-0.5 flex-shrink-0" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <div>
                                <h4 class="font-semibold text-yellow-800 mb-1">Important Note</h4>
                                <p class="text-yellow-700 text-sm">This is a practice test designed to simulate the
                                    actual JBT exam experience. Actual exam pattern and difficulty may vary.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Fullscreen Test Mode -->
    <div id="test-mode" class="test-mode">
        <div class="h-full flex flex-col">
            <!-- Test Header -->
            <div class="bg-white shadow-sm border-b">
                <div class="max-w-7xl mx-auto px-4 py-4">
                    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center">
                        <div class="mb-4 lg:mb-0">
                            <h1 class="text-xl font-bold text-gray-800">HP JBT 2025 Mock Test</h1>
                            <div class="flex items-center mt-2 text-sm">
                                <span id="current-section-name" class="font-medium text-blue-600">Loading...</span>
                                <span class="mx-2 text-gray-400">•</span>
                                <span id="question-counter" class="text-gray-600">Q1 of 25</span>
                                <span class="mx-2 text-gray-400">•</span>
                                <span class="text-gray-600">
                                    Answered: <span id="answered-count"
                                        class="font-medium text-green-600">0</span>/<span
                                        id="total-questions">100</span>
                                </span>
                            </div>
                        </div>

                        <div class="flex items-center space-x-4">
                            <div id="timer" class="bg-gray-100 px-4 py-2 rounded-lg font-mono font-bold text-lg border">
                                120:00
                            </div>
                            <button id="submit-test-btn"
                                class="bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-6 rounded-lg transition transform hover:scale-105">
                                Submit Test
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section Navigation -->
            <div class="bg-white border-b">
                <div class="max-w-7xl mx-auto px-4">
                    <div class="flex overflow-x-auto scrollbar-hide" id="section-tabs">
                        <!-- Tabs will be loaded dynamically -->
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="flex-1 overflow-y-auto bg-gray-50">
                <div class="max-w-4xl mx-auto px-4 py-6">
                    <!-- Question Container -->
                    <div id="question-container" class="bg-white rounded-xl shadow-sm p-6 mb-6">
                        <div class="text-center py-16">
                            <div class="spinner mx-auto mb-4"></div>
                            <p class="text-gray-600">Loading questions...</p>
                        </div>
                    </div>

                    <!-- Navigation Controls -->
                    <div class="bg-white rounded-xl shadow-sm p-4">
                        <div class="flex justify-between items-center">
                            <button id="prev-btn"
                                class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-3 px-6 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed"
                                disabled>
                                <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 19l-7-7 7-7" />
                                </svg>
                                Previous
                            </button>

                            <div class="text-center">
                                <div class="bg-gray-100 rounded-full h-2 w-64 mx-auto mb-2">
                                    <div id="progress-bar" class="progress-bar bg-blue-500 h-2 rounded-full"
                                        style="width: 0%"></div>
                                </div>
                                <p class="text-sm text-gray-600">Test Progress</p>
                            </div>

                            <button id="next-btn"
                                class="btn-primary text-white font-medium py-3 px-6 rounded-lg transition">
                                Next
                                <svg class="w-4 h-4 inline ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5l7 7-7 7" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Test Complete Modal -->
    <div id="test-complete-modal"
        class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <div class="text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Test Completed!</h2>
                <div class="bg-gray-50 rounded-lg p-4 mb-6">
                    <p class="text-3xl font-bold text-blue-600 mb-2">
                        <span id="test-score">0</span><span class="text-lg text-gray-500">/100</span>
                    </p>
                    <p class="text-gray-600">Final Score</p>
                </div>
                <div class="space-y-3">
                    <button id="review-test-btn"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition">
                        Review Answers
                    </button>
                    <button id="retake-test-btn"
                        class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-3 px-4 rounded-lg transition">
                        Take Test Again
                    </button>
                    <a href="/jbt/jbt.html"
                        class="block w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg text-center transition">
                        Back to JBT Resources
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-white flex items-center justify-center z-40 hidden">
        <div class="text-center">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-gray-600 text-lg">Loading test data...</p>
        </div>
    </div>

    <script>
        // Configuration - Update this path to your JSON file location
        const JSON_DATA_URL = 'pyq-2025.json'; // Change this to your GitHub raw URL

        let testData = null;
        let currentState = {
            currentSection: 0,
            currentQuestion: 0,
            answers: {},
            startTime: null,
            timerInterval: null,
            timeRemaining: 120 * 60, // 120 minutes in seconds
            isTestActive: false,
            testResults: null
        };

        // DOM elements
        const landingPage = document.getElementById('landing-page');
        const testMode = document.getElementById('test-mode');
        const startTestBtn = document.getElementById('start-test-btn');
        const submitTestBtn = document.getElementById('submit-test-btn');
        const testCompleteModal = document.getElementById('test-complete-modal');
        const reviewTestBtn = document.getElementById('review-test-btn');
        const retakeTestBtn = document.getElementById('retake-test-btn');
        const questionContainer = document.getElementById('question-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const timerElement = document.getElementById('timer');
        const currentSectionName = document.getElementById('current-section-name');
        const questionCounter = document.getElementById('question-counter');
        const answeredCount = document.getElementById('answered-count');
        const totalQuestions = document.getElementById('total-questions');
        const testScore = document.getElementById('test-score');
        const sectionTabsContainer = document.getElementById('section-tabs');
        const progressBar = document.getElementById('progress-bar');
        const loadingOverlay = document.getElementById('loading-overlay');

        // Load test data
        async function loadTestData() {
            try {
                loadingOverlay.classList.remove('hidden');

                // Try to load from JSON file first, fallback to sample data
                try {
                    const response = await fetch('pyq-2025.json');
                    if (response.ok) {
                        testData = await response.json();
                    } else {
                        throw new Error('JSON file not found');
                    }
                } catch (error) {
                    console.log('Loading sample data instead of JSON file');
                    testData = SAMPLE_TEST_DATA;
                }

                // Ensure each section has at least 25 questions by duplicating existing ones
                testData.sections.forEach(section => {
                    const originalQuestions = [...section.questions];
                    while (section.questions.length < 25) {
                        const sourceQuestion = originalQuestions[section.questions.length % originalQuestions.length];
                        const newQuestion = {
                            ...sourceQuestion,
                            id: `${sourceQuestion.id}_${Math.floor(section.questions.length / originalQuestions.length) + 1}`,
                            text: sourceQuestion.text + ` (Variant ${Math.floor(section.questions.length / originalQuestions.length) + 1})`
                        };
                        section.questions.push(newQuestion);
                    }
                });

                // Update duration from JSON
                currentState.timeRemaining = testData.duration * 60;

                // Generate section tabs
                generateSectionTabs();

                // Update total questions count
                const total = testData.sections.reduce((sum, section) => sum + section.questions.length, 0);
                totalQuestions.textContent = total;

                loadingOverlay.classList.add('hidden');
                return true;
            } catch (error) {
                console.error('Error loading test data:', error);
                loadingOverlay.classList.add('hidden');

                // Fallback to sample data
                testData = SAMPLE_TEST_DATA;
                generateSectionTabs();
                const total = testData.sections.reduce((sum, section) => sum + section.questions.length, 0);
                totalQuestions.textContent = total;
                return true;
            }
        }

        // Generate section tabs dynamically
        function generateSectionTabs() {
            const tabsHTML = testData.sections.map((section, index) => `
        <button class="section-tab px-6 py-3 font-medium border-b-3 border-transparent hover:bg-gray-50 transition-all duration-200 whitespace-nowrap ${index === 0 ? 'border-blue-500 text-blue-600 bg-blue-50' : 'text-gray-600'}" 
                data-section="${index}">
            ${section.title} (${section.questions.length})
        </button>
    `).join('');

            sectionTabsContainer.innerHTML = tabsHTML;

            // Add click listeners to tabs
            document.querySelectorAll('.section-tab').forEach((tab, index) => {
                tab.addEventListener('click', () => loadSection(index));
            });
        }

        // Initialize the test
        async function initTest() {
            if (!testData) {
                const loaded = await loadTestData();
                if (!loaded) return;
            }

            // Hide landing page, show test mode
            landingPage.style.display = 'none';
            testMode.style.display = 'block';

            // Set test as active
            currentState.isTestActive = true;
            currentState.startTime = new Date();

            // Start timer
            startTimer();

            // Load first section
            loadSection(0);

            // Update counters
            updateUI();

            // Prevent page refresh/back
            window.addEventListener('beforeunload', handleBeforeUnload);
        }

        // Handle before unload
        function handleBeforeUnload(e) {
            if (currentState.isTestActive) {
                e.preventDefault();
                e.returnValue = 'Your test progress will be lost. Are you sure you want to leave?';
                return e.returnValue;
            }
        }

        // Load a section
        function loadSection(sectionIndex) {
            if (!testData || sectionIndex >= testData.sections.length) return;

            currentState.currentSection = sectionIndex;
            currentState.currentQuestion = 0;

            const section = testData.sections[sectionIndex];
            currentSectionName.textContent = section.title;

            // Update active tab
            document.querySelectorAll('.section-tab').forEach((tab, index) => {
                if (index === sectionIndex) {
                    tab.classList.add('border-blue-500', 'text-blue-600', 'bg-blue-50');
                    tab.classList.remove('text-gray-600');
                } else {
                    tab.classList.remove('border-blue-500', 'text-blue-600', 'bg-blue-50');
                    tab.classList.add('text-gray-600');
                }
            });

            // Load first question of the section
            loadQuestion();
            updateUI();
        }

        // Load current question
        function loadQuestion() {
            const section = testData.sections[currentState.currentSection];
            const question = section.questions[currentState.currentQuestion];

            if (!question) return;

            const questionHTML = `
        <div class="fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-gray-800">
                    Question ${currentState.currentQuestion + 1}
                </h2>
                <span class="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full">
                    ${section.title}
                </span>
            </div>
            
            <div class="mb-6">
                <p class="text-lg text-gray-800 leading-relaxed mb-6">${question.text}</p>
                
                <div class="space-y-3">
                    ${question.options.map((option, index) => `
                        <label class="option-hover flex items-center p-4 border-2 rounded-lg cursor-pointer transition-all
                                     ${getAnswerForQuestion(question.id) === index ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-blue-300'}">
                            <input type="radio" 
                                   name="question-${question.id}" 
                                   value="${index}" 
                                   class="w-4 h-4 text-blue-600 mr-4"
                                   ${getAnswerForQuestion(question.id) === index ? 'checked' : ''}
                                   onchange="saveAnswer('${question.id}', ${index})">
                            <span class="text-gray-700 text-base">${option}</span>
                        </label>
                    `).join('')}
                </div>
            </div>
        </div>
    `;

            questionContainer.innerHTML = questionHTML;
        }

        // Save answer
        function saveAnswer(questionId, answerIndex) {
            currentState.answers[questionId] = answerIndex;
            updateUI();

            // Add visual feedback
            const selectedOption = document.querySelector(`input[name="question-${questionId}"][value="${answerIndex}"]`)?.parentElement;
            if (selectedOption) {
                selectedOption.classList.add('border-blue-500', 'bg-blue-50');

                // Remove selection from other options
                document.querySelectorAll(`input[name="question-${questionId}"]`).forEach((input, index) => {
                    if (index !== answerIndex) {
                        input.parentElement.classList.remove('border-blue-500', 'bg-blue-50');
                        input.parentElement.classList.add('border-gray-200');
                    }
                });
            }
        }

        // Get answer for a question
        function getAnswerForQuestion(questionId) {
            return currentState.answers[questionId] !== undefined ? currentState.answers[questionId] : null;
        }

        // Navigate to next question
        function nextQuestion() {
            const section = testData.sections[currentState.currentSection];

            if (currentState.currentQuestion < section.questions.length - 1) {
                currentState.currentQuestion++;
                loadQuestion();
            } else if (currentState.currentSection < testData.sections.length - 1) {
                // Move to next section
                loadSection(currentState.currentSection + 1);
            } else {
                // Last question of last section - submit test
                submitTest();
                return;
            }

            updateUI();
        }

        // Navigate to previous question
        function prevQuestion() {
            if (currentState.currentQuestion > 0) {
                currentState.currentQuestion--;
                loadQuestion();
            } else if (currentState.currentSection > 0) {
                // Move to previous section, last question
                const prevSectionIndex = currentState.currentSection - 1;
                const prevSection = testData.sections[prevSectionIndex];
                currentState.currentSection = prevSectionIndex;
                currentState.currentQuestion = prevSection.questions.length - 1;
                loadSection(prevSectionIndex);
            }

            updateUI();
        }

        // Update UI elements
        function updateUI() {
            if (!testData) return;

            const section = testData.sections[currentState.currentSection];

            // Update question counter
            questionCounter.textContent = `Q${currentState.currentQuestion + 1} of ${section.questions.length}`;

            // Update answered count
            const totalAnswered = Object.keys(currentState.answers).length;
            answeredCount.textContent = totalAnswered;

            // Update progress bar
            const totalQuestionsCount = testData.sections.reduce((sum, s) => sum + s.questions.length, 0);
            const progressPercentage = (totalAnswered / totalQuestionsCount) * 100;
            progressBar.style.width = `${progressPercentage}%`;

            // Update navigation buttons
            const isFirstQuestion = currentState.currentSection === 0 && currentState.currentQuestion === 0;
            const isLastQuestion = currentState.currentSection === testData.sections.length - 1 &&
                currentState.currentQuestion === testData.sections[testData.sections.length - 1].questions.length - 1;

            prevBtn.disabled = isFirstQuestion;

            if (isLastQuestion) {
                nextBtn.textContent = 'Submit Test';
                nextBtn.classList.remove('btn-primary');
                nextBtn.classList.add('bg-red-600', 'hover:bg-red-700');
            } else {
                nextBtn.textContent = 'Next';
                nextBtn.classList.add('btn-primary');
                nextBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
            }

            if (isFirstQuestion) {
                prevBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // Start timer
        function startTimer() {
            currentState.timerInterval = setInterval(() => {
                currentState.timeRemaining--;

                const hours = Math.floor(currentState.timeRemaining / 3600);
                const minutes = Math.floor((currentState.timeRemaining % 3600) / 60);
                const seconds = currentState.timeRemaining % 60;

                const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                timerElement.textContent = timeString;

                // Add warning styles
                timerElement.classList.remove('timer-warning', 'timer-critical');
                if (currentState.timeRemaining <= 300) { // 5 minutes
                    timerElement.classList.add('timer-critical');
                } else if (currentState.timeRemaining <= 900) { // 15 minutes
                    timerElement.classList.add('timer-warning');
                }

                // Auto submit when time is up
                if (currentState.timeRemaining <= 0) {
                    submitTest(true); // Auto-submit
                }
            }, 1000);
        }

        // Stop timer
        function stopTimer() {
            if (currentState.timerInterval) {
                clearInterval(currentState.timerInterval);
                currentState.timerInterval = null;
            }
        }

        // Calculate score
function calculateScore() {
    try {
        let score = 0;
        let sectionScores = {};

        if (!testData || !testData.sections) {
            console.error('Test data not available');
            return { total: 0, sections: {} };
        }

        testData.sections.forEach(section => {
            let sectionScore = 0;
            if (!section.questions) {
                console.warn('Section has no questions:', section);
                return;
            }

            section.questions.forEach(question => {
                const userAnswer = currentState.answers[question.id];
                if (userAnswer !== undefined && userAnswer === question.correct) {
                    score++;
                    sectionScore++;
                }
            });

            sectionScores[section.name || section.title] = {
                score: sectionScore,
                total: section.questions.length,
                percentage: Math.round((sectionScore / section.questions.length) * 100)
            };
        });

        return { total: score, sections: sectionScores };
    } catch (error) {
        console.error('Error calculating score:', error);
        return { total: 0, sections: {} };
    }
}

        // Submit test
        // Submit test - Fixed version with error handling
function submitTest(autoSubmit = false) {
    try {
        if (!autoSubmit && !confirm('Are you sure you want to submit the test? You cannot change your answers after submission.')) {
            return;
        }

        console.log('Submitting test...'); // Debug log

        // Stop timer
        stopTimer();
        console.log('Timer stopped'); // Debug log

        // Mark test as inactive
        currentState.isTestActive = false;

        // Remove beforeunload listener
        window.removeEventListener('beforeunload', handleBeforeUnload);

        // Calculate score
        console.log('Calculating score...'); // Debug log
        const results = calculateScore();
        console.log('Score calculated:', results); // Debug log

        // Check if modal exists
        const modal = document.getElementById('test-complete-modal');
        if (!modal) {
            console.error('Test complete modal not found!');
            alert(`Test completed! Your score: ${results.total}`);
            return;
        }

        // Show results
        const scoreElement = document.getElementById('test-score');
        if (scoreElement) {
            scoreElement.textContent = results.total;
        } else {
            console.error('Test score element not found!');
        }

        // Show modal
        modal.classList.remove('hidden');
        console.log('Modal should be visible now'); // Debug log

        // Store results for review
        currentState.testResults = results;

        console.log('Test submitted successfully!', results);

    } catch (error) {
        console.error('Error in submitTest:', error);
        alert('An error occurred while submitting the test. Please try again.');
    }
}

        // Review test answers
        function reviewTest() {
            testCompleteModal.classList.add('hidden');
            alert('Review mode will show all questions with correct answers and explanations.');
            // You can implement detailed review functionality here
        }

        // Retake test
        function retakeTest() {
            if (confirm('Are you sure you want to retake the test? All your current answers will be lost.')) {
                // Reset state
                currentState = {
                    currentSection: 0,
                    currentQuestion: 0,
                    answers: {},
                    startTime: null,
                    timerInterval: null,
                    timeRemaining: testData.duration * 60,
                    isTestActive: false,
                    testResults: null
                };

                // Hide modal and restart
                testCompleteModal.classList.add('hidden');
                initTest();
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Load test data on page load
            loadTestData();

            // Button event listeners
            startTestBtn.addEventListener('click', initTest);
            submitTestBtn.addEventListener('click', () => submitTest(false));
            reviewTestBtn.addEventListener('click', reviewTest);
            retakeTestBtn.addEventListener('click', retakeTest);
            nextBtn.addEventListener('click', nextQuestion);
            prevBtn.addEventListener('click', prevQuestion);

            // Close modal when clicking outside
            testCompleteModal.addEventListener('click', (e) => {
                if (e.target === testCompleteModal) {
                    testCompleteModal.classList.add('hidden');
                }
            });
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (!currentState.isTestActive) return;

            switch (e.key) {
                case 'ArrowLeft':
                    if (!prevBtn.disabled) prevQuestion();
                    break;
                case 'ArrowRight':
                    nextQuestion();
                    break;
                case '1':
                case '2':
                case '3':
                case '4':
                    if (e.ctrlKey || e.metaKey) return;

                    const section = testData.sections[currentState.currentSection];
                    const question = section.questions[currentState.currentQuestion];
                    const answerIndex = parseInt(e.key) - 1;

                    if (answerIndex >= 0 && answerIndex < question.options.length) {
                        saveAnswer(question.id, answerIndex);

                        // Update radio button visually
                        const radioButton = document.querySelector(`input[name="question-${question.id}"][value="${answerIndex}"]`);
                        if (radioButton) {
                            radioButton.checked = true;
                            radioButton.dispatchEvent(new Event('change'));
                        }
                    }
                    break;
            }
        });

        // Auto-save functionality
        function autoSave() {
            const saveData = {
                currentState: currentState,
                timestamp: new Date().toISOString()
            };
            window.testSaveData = saveData;
        }

        // Auto-save every 30 seconds
        setInterval(() => {
            if (currentState.isTestActive) {
                autoSave();
            }
        }, 30000);

        // Fullscreen functionality
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                testMode.requestFullscreen().catch(err => {
                    console.log('Fullscreen not supported');
                });
            } else {
                document.exitFullscreen();
            }
        }

    </script>

    <!-- Footer -->
    <div id="footer-placeholder"></div>
    <!-- Include the component loader -->
    <script src="/load-components.js"></script>
    <!-- Load Analytics Dynamically -->
    <script src="/assets/load-analytics.js"></script>

</body>

</html>